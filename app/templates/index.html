<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MG Event Hub | Dashboard v8.7</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
    <style>
        .fc-event { cursor: pointer; padding: 4px; font-size: 0.8em; border-radius: 4px; }
        .vibe-show { background-color: #10b981 !important; border: none !important; color: white !important; }
        .vibe-pousada { background-color: #3b82f6 !important; border: none !important; color: white !important; }
        .fc-daygrid-event { white-space: normal !important; align-items: flex-start !important; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 10px; }
    </style>
</head>
<body class="bg-slate-900 text-slate-100 font-sans">

    <header class="border-b border-slate-700 bg-slate-800/50 backdrop-blur-md p-4 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-black bg-gradient-to-r from-emerald-400 to-cyan-400 bg-clip-text text-transparent italic">
                MG EVENT HUB <span class="text-xs font-mono text-slate-500 not-italic">PRO v8.7</span>
            </h1>
            <div class="flex gap-3">
                <input type="text" id="searchCity" placeholder="Buscar cidade..." 
                       class="bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 transition-all">
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto p-6 grid grid-cols-1 lg:grid-cols-3 gap-8">
        
        <div class="lg:col-span-2 space-y-6">
            <div class="bg-slate-800 p-6 rounded-2xl border border-slate-700 shadow-2xl">
                <h2 class="text-xl font-bold mb-6 flex items-center gap-3">
                    <span class="p-2 bg-emerald-500/10 rounded-lg text-emerald-400">ðŸ“…</span> 
                    Agenda de Minas Gerais
                </h2>
                <div id="calendar"></div>
            </div>
        </div>

        <div class="space-y-6">
            <div class="bg-slate-800 p-6 rounded-2xl border border-slate-700 shadow-xl">
                <h2 class="text-xl font-bold mb-6 flex items-center gap-3 text-cyan-400">
                    <span class="p-2 bg-cyan-500/10 rounded-lg text-cyan-400">âš¡</span> 
                    Radar de Oportunidades
                </h2>
                <div id="eventFeed" class="space-y-4 max-h-[650px] overflow-y-auto pr-2">
                    </div>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            const calendarEl = document.getElementById('calendar');
            const feedEl = document.getElementById('eventFeed');
            
            const calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                locale: 'pt-br',
                headerToolbar: { left: 'prev,next today', center: 'title', right: 'dayGridMonth,dayGridWeek' },
                buttonText: { today: 'Hoje', month: 'MÃªs', week: 'Semana' },
                events: '/eventos',
                eventDataTransform: function(data) {
                    return {
                        id: data.id,
                        title: data.title,
                        start: data.start,
                        className: data.vibe === 'show' ? 'vibe-show' : 'vibe-pousada',
                        extendedProps: { cidade: data.cidade }
                    };
                },
                eventClick: function(info) {
                    Swal.fire({
                        title: info.event.title,
                        text: "Local: " + info.event.extendedProps.cidade,
                        icon: 'info',
                        background: '#1e293b',
                        color: '#f1f5f9',
                        confirmButtonColor: '#10b981'
                    });
                }
            });
            calendar.render();

            async function loadFeed() {
                try {
                    const res = await fetch('/eventos');
                    const eventos = await res.json();
                    if (eventos.error) throw new Error(eventos.error);
                    
                    feedEl.innerHTML = eventos.map(e => `
                        <div class="bg-slate-700/50 p-4 rounded-xl border-l-4 ${e.vibe === 'show' ? 'border-emerald-500' : 'border-blue-500'} hover:bg-slate-700 transition-all group">
                            <div class="flex justify-between items-start mb-2">
                                <span class="text-[10px] font-bold uppercase tracking-widest text-slate-400 group-hover:text-slate-200">${e.cidade}</span>
                                <span class="text-xs font-mono font-bold text-emerald-400">R$ ${e.preco_base.toLocaleString('pt-BR')}</span>
                            </div>
                            <h3 class="text-sm font-bold uppercase leading-tight text-white mb-2">${e.title}</h3>
                            <div class="flex items-center text-[10px] text-slate-500 font-medium">
                                <span>ðŸ“… ${new Date(e.start + 'T00:00:00').toLocaleDateString('pt-BR')}</span>
                            </div>
                        </div>
                    `).join('');
                } catch (err) {
                    feedEl.innerHTML = `<p class="text-red-400 text-xs">Erro ao carregar feed: ${err.message}</p>`;
                }
            }
            loadFeed();
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</body>
</html>