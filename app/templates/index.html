<script>
    document.addEventListener('DOMContentLoaded', async function() {
        const calendarEl = document.getElementById('calendar');
        const feedEl = document.getElementById('eventFeed');
        
        const calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            locale: 'pt-br',
            events: '/eventos',
            eventDataTransform: function(data) {
                // Sincronização direta: API entrega 'title' e 'start'
                return {
                    id: data.id,
                    title: data.title,
                    start: data.start,
                    className: data.vibe === 'show' ? 'vibe-show' : 'vibe-pousada',
                    extendedProps: { cidade: data.cidade }
                };
            },
            eventClick: function(info) {
                alert('Evento: ' + info.event.title + '\nCidade: ' + info.event.extendedProps.cidade);
            }
        });
        calendar.render();

        async function loadFeed() {
            const res = await fetch('/eventos');
            const eventos = await res.json();
            feedEl.innerHTML = eventos.map(e => `
                <div class="bg-slate-700 p-3 rounded-lg border-l-4 ${e.vibe === 'show' ? 'border-emerald-500' : 'border-blue-500'}">
                    <div class="flex justify-between items-start text-[10px] text-slate-400">
                        <span>${e.cidade}</span>
                        <span class="text-emerald-400">R$ ${e.preco_base}</span>
                    </div>
                    <h3 class="text-sm font-bold mt-1 uppercase text-white">${e.title}</h3>
                </div>
            `).join('');
        }
        loadFeed();
    });
</script>